#!/bin/bash

# Default: do not rebuild backend
REBUILD_BACKEND=false

# Parse command line arguments
while [[ $# -gt 0 ]]; do
    case "$1" in
        -b|--backend)
            REBUILD_BACKEND=true
            shift
            ;;
        *)
            echo "Unknown option: $1"
            shift
            ;;
    esac
done

# Rebuild frontend production image
echo "Rebuilding frontend production image..."
docker-compose build frontend-prod

# Rebuild backend if requested
if [ "$REBUILD_BACKEND" = true ]; then
    echo "Rebuilding backend image..."
    docker-compose build backend
else
    echo "Note: must specify -b or --backend if you want to rebuild the backend."
fi

# Restart containers
echo "Restarting frontend production container..."
docker-compose up -d frontend-prod

if [ "$REBUILD_BACKEND" = true ]; then
    echo "Restarting backend container..."
    docker-compose up -d backend
fi

echo "Done! Latest code is now live."
echo "  Prod: https://korysanchez.me"
echo "   Dev: http://$(hostname -I | awk '{print $1}'):3000"